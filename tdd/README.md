# Test-Driven Development: By Example

시작한 날짜: 2020-01-12



`Clean code that works!` 작동하는 깔끔한 코드가 테스트 주도 개발의 궁극적 목표이다.



## 테스트 주도 개발의 규칙

- 오직 자동화된 테스트가 실패할 경우에만 새로운 코드를 작성한다.
- 중복을 제거한다.

> 테스트를 쉽게 만들려면 반드시 응집도는 높고 결합도는 낮은 컴포넌트들로 구성되게끔 설계해야 한다.



### 두 가지 규칙에 의한 프로그래밍 순서

1. 빨강
   실패하는 작은 테스트를 작성한다. 처음에는 컴파일조차 되지 않을 수 있다.
2. 초록
   빨리 테스트가 통과하게끔 만든다. 이를 위해 어떤 죄악을 저질러도 좋다.
3. 리팩토링
   일단 테스트를 통과하게만 하는 와중에 생겨난 모든 중복을 제거한다.

빨강/초록/리팩토링은 TDD의 주문과도 같은 것





좀 더 자세히

#### 할일 목록 작성

앞으로 어떤 일을 해야 하는지 알려주고, 지금 하는 일에 집중할 수 있도록 도와주며, 언제 일이 다 끝나는지 알려줄 수 있게끔 할일 목록을 작성한다.

또다른 테스트가 생각날 수 있으며, 생각나면 할일 목록에 새로운 항목을 추가한다.



- 어떤 객체부터 있어야 할까?가 아닌 **우선 어떤 테스트가 필요할까?**의 관점으로 테스트 목록을 작성한다.



#### 테스트를 작성할 때

- 테스트 작성 순서는 작고 쉬워보이는 것부터 해라

복잡해 보이는 것은 작은 단위로 나눠서 시작하던지, 아예 손을 대지 않는게 좋다.



- 가짜 구현에서 진짜 구현으로 작업하는게 명확할 때와 순방향으로 작업하는게 명확할 때가 있다.

단순히 상수를 변수로 치환하는 일은 가짜에서 진짜 구현으로 작업하는 것



- 막대가 초록색이고 코드에 더 할 것이 명확하지 않으면 일단 그 상태에서 테스트를 작성한다.



- 클래스를 명시적으로 검사하는 코드가 있을 때에는 항상 다형성을 사용하도록 바꿔서 명시적인 클래스 검사를 제거한다.



- TDD로 구현할 땐 테스트 코드의 줄 수와 모델 코드의 줄 수가 거의 비슷한 상태로 끝난다.
- TDD가 자신의 방법에 비해 어떻게 다른지 직접 측정해 보아야 할 것이다. 이때 디버깅, 통합 작업, 다른 사람에게 설명하는 데 걸리는 시간 등의 요소를 반드시 포함해야 한다는 것을 기억하기 바란다.



- 미래에 코드를 읽을 다른 사람들을 염두에 둔 테스트를 작성한다.



### TDD 주기

1. 작은 테스트를 추가한다.
2. 모든 테스트를 실행하고, 실패하는 것을 확인한다.
3. 코드에 변화를 준다.
4. 모든 테스트를 실행하고, 성공하는 것을 확인한다.
5. 중복을 제거하기 위해 리팩토링한다.



## xUnit 

- 리팩토링의 일반적인 패턴 (TDD에서 볼 수 있는 리팩토링 패턴)

하나의 특별한 사례에 대해서만 작동하는 코드를 가져다가 다른 여러 사례에 대해서도 작동할 수 있도록 **상수를 변수로 변화**시켜 일반화하는 것

머릿속 순수한 추론에 의해 일반화하게 하지 않고, 잘 돌아가는 구체적인 사례에서 시작하여 일반화할 수 있게 해 준다. 



- 상위 클래스에 있는 속성만 사용하는 건 상위 클래스로 올라가는게 좋다.



#### 테스트를 작성하다보면 느끼는 3A 패턴

1. 준비(arrange): 객체를 생성한다.
2. 행동(act): 어떤 자극을 준다.
3. 확인(assert): 결과를 검사한다.



- 테스트 커플링을 만들지 말 것
- 한번에 메서드 하나 이상 수정하지 않으면서 테스트가 통과하게 만들 수 있는 방법을 찾아내려고 노력해라
- 다른 테스트가 존재하고 잘 돌아간다면(그리고 오직 그럴 때에만) 테스트를 단순화할 수 있다

- 테스트를 구현하는 순서는 중요하다. 다음에 구현할 테스트를 선택할 때, 나에게 뭔가 가르침을 줄 수 있고 내가 만들 수 있다는 확신이 드는 것을 선택한다.
- 만약 테스트를 하나 성공시켰는데 그 다음 테스트를 만들며 문제가 생기면 난 **두 단계 뒤로 물러서는 것을 고려**한다.

- 실패한 테스트를 발견하면 좀더 세밀한 단위의 테스트를 작성해서 올바른 결과를 출력



- 중요한 문제를 발견했는데 이를 바로 처리하기보다는 할일 목록에 적어두었다.

> 한 테스트를 처리하다가 발견한 문제는 바로 처리하지 않고, 할일 목록에 추가해두고 풀고 있던 문제를 먼저 해결한다. (나중에 코드를 번복을 하게되더라도 괜찮다)



