# 10. 시퀀스 해킹, 해시, 슬라이스

- 덕 타이핑을 지원하는 파이썬 언어에서의 프로토콜은 비공식 인터페이스이다.

- `__getitem__()`, `__len__()` 메서드를 구현하면 시퀀스처럼 동작한다. 
- slice(a, b, c) 객체를 생성하고 `__getitem__()` 메서드에서 처리함으로써 my_seq[a:\b:c]가 내부적으로 작동하는 방식을 살펴봄
  - 파이썬 시퀀스의 작동 방식과 유사하게 새로운 Vector 객체를 반환함으로써 슬라이싱에 대해 올바로 반응하도록 만듦
- `__getattr__()` 메서드 구현
  - my_vec.x와 같은 구문을 이용해서 처음 몇 개의 Vector 요소에 읽기 전용으로 접근할 수 있도록
  - my_vec.c = 7처럼 특별 요소에 값을 할당하고 싶어 하게 되므로, 버그가 발생할 수 있다.
  - 이 문제는 `__setattr__()` 메서드를 구현해서 단일 문자 속성에 값을 할당하지 못하게 함으로써 해결
  - `__getattr__()` 메서드를 구현하는 경우 일관성 없는 작동을 피하려면 `__setattr__()` 메서드도 함께 구현해야 하는 경우가 대부분이다.
- `__hash__()` 메서드 구현
  - functools.reduce()를 사용할 기회를 가졌다. 
    - 전체 Vector에 대한 해시를 계산하기 위해 Vector의 각 요소의 해시에 XOR 연산자(^)를 연속으로 적용해야 하기 때문
  - `__hash__()` 메서드에서 reduce() 함수를 사용한 후, `__eq__()` 메서드를 더 효율적으로 개선하기 위해 내장된 리듀스 함수 중 하나인 all()을 사용했다.
- 10장에서는 Vector2d로 할 수 있는 것을 모두 Vector도 할 수 있게 하자는 약속을 지키기 위해 커스텀 포맷을 지원하도록 구현했다.
  - 기본적인 직교좌표 외에 구면좌표를 지원하는 Vector2d 클래스의 `__format__()` 메서드에 맞춰 Vector 클래스의 `__format__()` 메서드도 다시 구현했다.
- 9장과 마찬가지로 이 장에서도 표준 파이썬 객체가 동작하는 방식을 살펴보고 따라함으로써 Vector 객체도 파이썬스럽게 만들었다.



## 10.1 Vector: 사용자 정의 시퀀스형

## 10.2 VEctor 버전 #1: Vector2d 호환

상속이 아니라 구성을 이용해서 벡터를 구현한다.

Vector2d 클래스와 호환성이 높은 기본 Vector 클래스를 만들고, (Vector([3,4])는 Vector2d(3,4)와 동일한 결과를 생성한다.)
요소들을 실수형 배열에 저장하고, 벡터가 불변 균일 시퀀스처럼 작동하게 만들기 위해 필요한 메서드들을 구현한다.

필자가 Vector 클래스가 시퀀스 프로토콜을 구현하는 독자적인 예제를 원했다.

## 10.4 Vector 버전 #2: 슬라이스 가능한 시퀀스







## 10.3 프로토콜과 덕 타이핑

파이썬에서는 완전히 작동하는 시퀀스형을 만들려면 시퀀스 프로토콜에 따르는 메서드를 구현하면 됩니다.

특별한 클래스를 상속할 필요가 없음을 1장에서 설명했었습니다.

그런데 여기서 말하는 프로토콜은 무엇일까요?



객체지향 프로그래밍에서 프로토콜은 문서에만 정의되어 있고 실제 코드에서는 정의되지 않는 비공식 인터페이스 입니다.

예를 들어 파이썬의 시퀀스 프로토콜은 `__len__()`과 `__getitem__()` 메서드를 동반할 뿐이다.

표준 시그니처와 의미에 따라 이 메서드들을 구현하는 어떠한 클래스도 시퀀스가 필요한 곳에 사용될 수 있다.

그 클래스의 슈퍼클래스가 무엇인지는 중요하지 않다. 단지 필요한 메서드만 제공하면 된다.



[예제 10-3]

코드 어디에서도 시퀀스 프로토콜을 따른다고 정의한 곳은 없다.

이 클래스가 object를 상속하고 있지만 파이썬 경험이 있는 프로그래머들은 이 코드를 보고 시퀀스라는 것을 알 수 있다.

이 클래스가 시퀀스처럼 동작하기 때문에 시퀀스인 것이다.

바로이 점이 중요하다.

이 장을 시작할 때 인용한 알렉스 마르텔리의 글에 다라 이 메커니즘을 **덕 타이핑**이라고 부른다.

프로토콜이 비공식적이며 강제로 적용되는 사항이 아니므로 클래스가 사용되는 특정 환경에 따라 프로토콜의 일부만 구현할 수도 있다.

> 강제적이란?
>
> 런타임에, 실행했을 때 에러가 발생하는 것.
>
> 컴파일 당시에는 에러가 안남







---



## 뒷이야기

### 비공식 인터페이스로서의 프로토콜

**프로토콜**

- 프로토콜은 파이썬에서 고안된 것이 아니다.
- '객체지향'이라는 표현을 만들어낸 스몰토크팀에서 요즈음에는 인터페이스라고 불리는 것의 동의어로서 '프로토콜'이라는 용어를 사용했다.
- 컴파일러가 강제하는 공식 인터페이스에 익숙한 사람들에게 '프로토콜'을 설명할 때 '비공식 인터페이스'라고 간략히 설명하는 것이 적절하다고 생각한다.
  - 일부 스몰토크 프로그래밍 환경에서는 일련의 메서드에 프로토콜로 태깅할 수 있게 해주었지만, 이 기능은 단지 문서화를 위한 것이었을 뿐 언어에서 강제하는 기능은 아니었다.
- 동적 자료형을 사용하는 언어에서는 자연스럽게 프로토콜이 발전한다.
  - 메서드 시그너처와 변수에 정적 자료형 정보가 없으므로 런타임에 자료형을 검사하는 것이다.
  - 루비도 동적 자료형과 프로토콜을 사용하는 객체지향 언어다.
- 파이썬 문서를 볼 때 'file과 비슷한 객체'라는 설명이 나오면 프로토콜에 대해 설명하고 있음을 알 수 있다.
  - 이 설명은 '해당 상황에서 file 인터페이스의 일부분을 구현함으로써 file과 충분히 비슷하게 동작하는 객체'라고 해석할 수 있다.
- 프로토콜의 일부분만 구현하는 것은 엉성하다고 생각할 수 있지만, 작업을 간단히 수행할 수 있다는 장점이 있다.

> 스몰토크
>
> - 동적형, 반영을 지원하는 객체 지향 프로그래밍 언어
> - https://en.wikipedia.org/wiki/Smalltalk

> 프로토콜
>
> - 복수의 컴퓨터 사이나 중앙 컴퓨터와 단말기 사이에서 데이터 통신을 원활하게 하기 위해 필요한 **통신 규약**. 
> - 신호 송신의 순서, 데이터의 표현법, 오류(誤謬) 검출법 등을 정함. 통신 규약(通信規約).



### 덕 타이핑의 기원

2000년 7월 26일 알렉스 마르텔리가 파이썬 뉴스 그룹에 게시한 메시지 '다형성'에서 찾아볼 수 있다.

http://bit.ly/1QOuTPx



### 파이썬스러움에 대한 추구

'아름다움이란 무엇인가?'라는 질문과 마찬가지로 '파이썬스러움이란 무엇인가?'라는 질문에 하나의 답이 있을 수 없다.

[n번째 리스트 요소의 합계를 구하는 파이썬스러운 방법은?](http://bi.ly/1QOv5y5)

