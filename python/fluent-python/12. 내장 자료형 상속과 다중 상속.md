# 12. 내장 자료형 상속과 다중 상속

12장에서는 상속에 대해 설명하는데, 특히 파이썬과 관련해서 다음 두 가지 특징을 집중적으로 알아봅니다.

- 내장 자료형 상속의 위험성
- 다중 상속과 메서드 결정 순서



1. 먼저 내장 자료형을 상속하는 문제부터 알아본다.
   1. C언어로 구현된 네이티브 메서드는 몇몇 특별한 경우를 제외하고는 
      서브클래스가 오버라이드한 메서드를 호출하지 않는다.
   2. 그렇기 때문에 list, dict, str 형을 커스터마이즈해야 할 때는 `collection` 모듈에 정의된 UserList, UserDict, UserString을 상속하는 것이 좋다.
      1. 이 사례는 표준 라이브러리에서 상속보다 구성을 선호하는 사례를 보여준다.
   3. 원하는 행동이 내장 자료형이 제공하는 기능과 상당히 다를 때는 `collection.abc`에서 제공하는 적절한 ABC를 상속해서 직접 구현하는 것이 좋다. 
2. 그러고 나서 이 장이 끝날 때까지 사례 연구를 이용해서 다중 상속을 설명하고,
   1. 다중 상속은 양날의 검이다.
   2. 먼저 `__mro__` 클래스 속성에 저장된 메서드 결정 순서가 상속된 메서드의 이름 충돌 문제를 어떻게 해결하는지 살펴보았다.
   3. 그리고 내장된 함수 `super()`가 `__mro__`에 따라 슈퍼클래스의 메서드를 호출하는 방법에 대해 알아보았다.
   4. Tkinter는 최신의 모범적인 관례를 따르지 않으므로 믹스인 클래스를 사용하는 방법과 다중 상속을 피하고 대신 구성을 이용해서 다중 상속 문제를 해결하는 방법을 알아보았다.
   5. 장고는 믹스인을 훌륭히 사용하고 있는 듯하다.
      1. 다중 상속의 위험과 유해성이 지나치게 확대 포장되어 있다. 사실 나는 다중 상속과 관련해서 그다지 큰 문제를 겪지 않았다. - 레나르트 레제브로
3. 클래스 계층구조를 만들 때 좋은 방법과 나쁜 방법에 대해 설명한다.



다중 상속을 사용할지 여부에 대해서, 선택의 여지가 없는 경우도 종종 있다. 우리가 사용하는 프레임워크가 이미 결정했기 때문이다.



## 12.1 내장 자료형의 상속은 까다롭다

공식적으로 CPython은 내장 자료형의 서브클래스에서 오버라이드한 메서드가 언제 호출되는지, 혹은 호출되지 않는지에 대한 명확한 규칙을 정의하지 않는다. 
일반적으로 서브클래스에서 오버라이드한 메서드는 같은 객체의 다른 내장 메서드에 의해 결코 호출되지 않는다.
예를 들어 dict의 서브클래스에서 오버라이드한 `__getitem__()` 메서드는 내장된 `get()`과 같은 메서드에 의해 호출되지 않는다.



## 12.2 다중 상속과 메서드 결정 순서

p. 443 [예제 12-4]

MRO(Method Resolution Order, 메서드 결정 순서)



## 12.3 실세계에서의 다중 상속

## 12.4 다중 상속 다루기

뒤엉킨 클래스 그래프가 만들어지는 것을 예방하는 방법

> 구상클래스
>
> https://e2xist.tistory.com/581

### 1. 인터페이스 상속과 구현 상속 분리하기

다중 상속을 다룰 때는 우선 상속 이유를 명확히 하는 것이 도움이 된다.

상속을 하는 이유는 주로 다음과 같다.

- 인터페이스 상속은 'is-a' 관계를 의미하는 서브타입을 생성한다.
- 구현 상속은 재사용을 통해 코드 중복을 피한다.

실제로 이 두 가지 목적을 모두 가진 경우가 많지만, 의도를 명확히 할 수 있을 때는 명백히 표현하는 것이 좋다.
코드 재사용을 위한 상속은 구현에 관련된 것이며, 구성이나 위임으로 대체할 수 있는 경우도 종종 있다. 한편 인터페이스 상속은 프레임워크에서 중추적인 역할을 수행한다.

### 2. ABC를 이용해서 인터페이스를 명확히 하기

인터페이스를 정의하기 위해 만들어진 클래스를 ABC로 명시한다.

### 3. 코드를 재사용하기 위해 믹스인을 사용한다

'is-a' 관계를 나타내지 않고 서로 관련 없는 여러 서브클래스에서 코드를 재사용하기 위해 설계된 클래스는 명시적으로 믹스인 클래스로 만들어야 한다.

- 개념적으로 믹스인 클래스는 새로운 자료형을 정의하지 않고, 
  단지 재사용할 메서드들을 묶어놓을 뿐이다.
- 믹스인 클래스로 객체를 생성하면 안 되며, 믹스인 클래스를 상속하는 구상 클래스는 다른 클래스도 상속해야 한다.
- 각각의 믹스인 클래스는 밀접히 연관된 메서드 몇 개를 구현해서 하나의 구체적인 행위를 제공해야 한다.

### 4. 이름을 통해 믹스인임을 명확히 한다.

파이썬에서는 믹스인 클래스를 명시하는 공식적인 방법이 없으므로,
클래스명 뒤에 Mixin을 붙일 것을 강력히 권장한다.

### 5. ABC가 믹스인이 될 수는 있지만, 믹스인이라고 해서 ABC인 것은 아니다

ABC는 구상 메서드를 구현할 수 있으므로 믹스인으로 사용할 수도 있다.

그리고 ABC는 자료형을 정의하지만, 믹스인은 자료형을 정의하지 않는다.

게다가 ABC는 다른 클래스의 유일한 기저 클래스가 될 수 있는 반면,
믹스인 하나만 사용해서 서브클래스를 정의하면 안 된다

믹스인에는 적용되지 않고 ABC에만 적용되는 제한이 하나 있다.
ABC에서 구현된 구상 메서드는 해당 ABC나 슈퍼클래스의 메서드만 사용할 수 있다.
즉, ABC에 정의된 구상 메서드는 일종의 편의를 위한 것일 뿐이다. 구상 메서드가 수행하는 모든 것은 ABC의 다른 메서드를 호출해서 동일하게 수행할 수 있기 때문이다.

### 6. 두 개 이상의 구상 클래스에서 상속받지 않는다.

구상 클래스는 0개 또는 많아야 하나의 구상 슈퍼클래스를 가져야 한다.
즉, 구상 클래스의 슈퍼클래스 중 하나를 제외한 나머지 클래스는 ABC나 믹스인이어야 한다.

### 7. 사용자에게 집합 클래스를 제공한다.

ABC 또는 믹스인을 조합해서 호출 코드에 유용한 기능을 제공할 수 있을 때는, 이들을 적절히 통합하는 클래스를 제공하는 것이 좋다. -> 이런 클래스를 집합 클래스(Aggregate Class)라고 불렀다.

```python
class Widget(BaseWidget, Pack, Place, Grid):
    pass
```

Widget 클래스의 본체가 비어있지만, 클래스는 각종 서비스를 제공한다.

### 8. 클래스 상속보다 객체 구성을 사용하라

상속에 익숙해지면 과도하게 사용하기 쉬워진다.
객체를 계층구조로 깔끔하게 정리하면 보기 좋아지며, 프로그래머는 이 일을 즐기게 된다.

그러나 구성을 더 좋아하게 되면 설계의 융통성이 향상된다.

상속은 클래스들을 강하게 결합시키며, 상속 트리의 높이가 높아지면 구조가 불안정해진다.

다른 클래스에 서비스를 제공하기 위해 사용할 때는 구성과 위임이 믹스인을 대체할 수 있지만, 자료형의 계층구조를 정의할 때는 구성과 위임이 인터페이스 상속을 대체할 수 없다.

## 12.5 최신 사례: 장고 제네릭 뷰의 믹스인

