---
layout: post
title: aws/ load balancer
date: 2018-07-18 10:11:00 KST
tags: [aws]
---

## issue

AWS의 Load Balancer(로드 밸런서) 사용하기

<br>

## where is 'Load Balancer'?

컴퓨팅 > EC2 에 들어가 '로드밸런서' 클릭

'로드 밸런서 생성' 클릭

로드 밸런서 유형 선택 > **Network Load Balancer** 선택

- Application Load Balancer: 80, 443 포트만 사용할 때

- Network Load Balancer: 80, 443 외의 포트도 사용할 때 

<br>

## set up

### 단계 1: 로드 밸런서 구성

#### 기본 구성

- 이름
- 체계
    
    **인터넷 연결**을 선택합니다.
    
    - 인터넷 연결: 외부 접속을 허용
    - 내부: 외부 접속을 차단

#### 리스너

구성한 프로토콜 및 포트를 사용하여 연결 요청을 확인하는 프로세스

- 로드 밸런서 포트

    메인으로 쓸 포트로 설정해주시면 됩니다.

    다른 포트도 허가하고 싶다면 다음 페이지에서 추가할 수 있습니다.

#### 가용 영역

내가 선택한 region(지역)에 존재하는 _가용 영역_ 중에서 로드 밸런서가 활동할 영역을 선택해주면 됩니다.

저는 모두 선택하였습니다.

### 단계 2: 라우팅 구성

#### 대상 그룹

단계 1에서 설정한 포트 외의 포트도 포함시키고 싶을 때 입력하시면 됩니다. 

없으면 바로 다음 단계로 넘어가시면 됩니다.

- 대상 그룹: 새 대상 그룹

- 포트: 단계 1에서 설정한 포트 외의 다른 포트

- 대상 유형
    
    **instance**를 선택합니다.
    
    - instance: 도메인, AWS EC2 주소로 접근할 수 있다
    - ip: 그 외의 서버, IP 주소로 접근할 수 있다

#### 상태 검사

프로토콜 **TCP** 선택

<br>

### 단계 3: 대상 등록

아래쪽에 있는 **인스턴스**에서 로드 밸런스에 등록할 인스턴스를 선택하여 `등록된 항목에 추가` 하세요.

### 단계 4: 검토

내가 원하는 대로 설정했는지 확인해주신 후 `생성`을 클릭해주시면 됩니다.

<br>

## confirm

로드밸런서 목록에서 생성된 로드밸런서를 확인할 수 있습니다.

목록에서 만든 로드밸런서를 클릭하면 아래쪽에 **DNS 이름**가 앞으로 EC2 인스턴스를 호출할 때 대신 쓰는 주소입니다.

로드밸런서에 등록한 인스턴스를 호출하는 주소 대신 로드밸런서의 **DNS 이름**을 넣고 엔터를 치면 정상적으로 활동할 수 있는 것을 확인할 수 있습니다.

<br>

## epilogue

이로써 서버 하나가 죽어도 다른 서버가 대신 활동하여 정상적인 상태를 유지할 수 있게 되었습니다!

로드밸런서에 여러개를 등록했을 때, 여러개가 같은 역할을 수행중이라면 호출했을 때 어떤 서버에 먼저 호출하는지 궁금해졌어요. 다음에 기회가 된다면 확인해보고 싶습니다.

